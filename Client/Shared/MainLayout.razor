@inherits LayoutComponentBase
@inject IThemeService ThemeService

<div class="@($"app-container {(ParentApp?.IsDarkMode == true ? "dark" : "")}")">
    <MudLayout>
        <MudAppBar Elevation="0" 
                   Color="Color.Transparent" 
                   Class="border-b border-gray-200 dark:border-gray-800 backdrop-blur-sm">
            <MudIconButton Icon="@Icons.Material.Filled.Menu" 
                          Color="@(ParentApp?.IsDarkMode == true ? Color.Surface : Color.Dark)" 
                          Edge="Edge.Start" 
                          OnClick="@ToggleDrawer" />
            <MudText Typo="Typo.h6" 
                    Color="@(ParentApp?.IsDarkMode == true ? Color.Surface : Color.Dark)" 
                    Class="ml-4 font-bold">Music Manager</MudText>
            <MudSpacer />
            <MudToggleIconButton
                @bind-Toggled="@_isDarkMode"
                Icon="@Icons.Material.Filled.LightMode"
                Color="@(ParentApp?.IsDarkMode == true ? Color.Surface : Color.Dark)"
                Title="Light Mode"
                ToggledIcon="@Icons.Material.Filled.DarkMode"
                ToggledTitle="Dark Mode" />
            <MudIconButton Icon="@Icons.Material.Filled.Notifications" 
                          Color="@(ParentApp?.IsDarkMode == true ? Color.Surface : Color.Dark)" 
                          OnClick="@ToggleNotifications" />
        </MudAppBar>

        <MudDrawer @bind-Open="@_drawerOpen" 
                   ClipMode="DrawerClipMode.Always" 
                   Elevation="0" 
                   Color="@(ParentApp?.IsDarkMode == true ? Color.Dark : Color.Surface)"
                   Variant="@DrawerVariant.Mini" 
                   Class="border-r border-gray-200 dark:border-gray-800">
            <NavMenu />
        </MudDrawer>

        <MudMainContent>
            <div class="@($"min-h-screen bg-gradient-to-br {(ParentApp?.IsDarkMode == true ? "from-gray-900 to-gray-800" : "from-gray-50 to-indigo-50")}")">
                <div class="pt-16">
                    <NotificationList @bind-IsOpen="_showNotifications" />
                    @Body
                </div>
            </div>
        </MudMainContent>
    </MudLayout>
</div>

<style>
    .app-container {
        min-height: 100vh;
    }
    
    .app-container.dark {
        color-scheme: dark;
    }
</style>

@code {
    [CascadingParameter]
    public App? ParentApp { get; set; }
    
    private bool _drawerOpen = true;
    private bool _showNotifications;
    private bool _isDarkMode
    {
        get => ParentApp?.IsDarkMode ?? false;
        set
        {
            if (ParentApp?.IsDarkMode != value)
            {
                ParentApp.IsDarkMode = value;
            }
        }
    }

    private void ToggleDrawer()
    {
        _drawerOpen = !_drawerOpen;
    }

    private void ToggleNotifications()
    {
        _showNotifications = !_showNotifications;
    }

    private void ToggleTheme()
    {
        if (ParentApp != null)
        {
            ParentApp.IsDarkMode = !ParentApp.IsDarkMode;
        }
    }
}